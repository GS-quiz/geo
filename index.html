<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geography Quiz</title>
    <!-- Updated Favicon: Geography 'G' Icon with Earth Tones -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><linearGradient id=%22g%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22><stop offset=%220%25%22 stop-color=%22%230284c7%22/><stop offset=%22100%25%22 stop-color=%22%230369a1%22/></linearGradient><rect width=%22100%22 height=%22100%22 rx=%2230%22 fill=%22url(%23g)%22/><text x=%2250%22 y=%2250%22 dominant-baseline=%22central%22 text-anchor=%22middle%22 font-family=%22Calibri, sans-serif%22 font-weight=%22900%22 font-size=%2260%22 fill=%22white%22>G</text></svg>"
    />
    <!-- React Dependencies -->
    <script
      src="https://unpkg.com/react@18/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- External Data File (Optional - Falls back to Mock Data if missing) -->
    <script
      src="quiz-data.js"
      onerror="console.log('Local quiz-data.js not found, using mock data.')"
    ></script>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: [
                "Calibri",
                "Gill Sans",
                "Gill Sans MT",
                "Trebuchet MS",
                "sans-serif",
              ],
            },
            colors: {
              gray: {
                850: "#1f2937",
                900: "#111827",
                950: "#030712",
              },
              // Changed from History Red to Geography Blue
              geography: {
                light: "#0284c7", // Sky-600
                dark: "#0369a1", // Sky-700
              },
            },
            animation: {
              "fade-in": "fadeIn 0.6s ease-out",
              "slide-up": "slideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)",
              "scale-in": "scaleIn 0.3s ease-out",
            },
            keyframes: {
              fadeIn: { "0%": { opacity: "0" }, "100%": { opacity: "1" } },
              slideUp: {
                "0%": { opacity: "0", transform: "translateY(30px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
              scaleIn: {
                "0%": { opacity: "0", transform: "scale(0.9)" },
                "100%": { opacity: "1", transform: "scale(1)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: "Calibri", "Gill Sans", "Gill Sans MT", "Trebuchet MS",
          sans-serif;
        overflow-y: auto;
        overflow-x: hidden;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #94a3b8;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #4b5563;
      }
      .dark ::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }
      * {
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300 selection:bg-sky-500 selection:text-white"
  >
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, memo } = React;

      // --- MOCK DATA FALLBACK (UPDATED FOR GEOGRAPHY) ---
      const MOCK_DATA = `
[SUBJECT: GEOGRAPHY]
[CHAPTER: World Geography (Demo)]
Q: Which is the largest ocean in the world?
A) Atlantic Ocean
B) Indian Ocean
C) Pacific Ocean
D) Arctic Ocean
ANS: C

Q: Which country has the most natural lakes?
A) India
B) United States
C) Canada
D) Australia
ANS: C

Q: What is the capital city of Australia?
A) Sydney
B) Melbourne
C) Canberra
D) Brisbane
ANS: C
      `;

      // --- ICON SYSTEM ---
      const ICONS = {
        // Updated: Added Globe for Geography
        globe: (
          <React.Fragment>
            <circle cx="12" cy="12" r="10" />
            <line x1="2" x2="22" y1="12" y2="12" />
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
          </React.Fragment>
        ),
        // Kept original Scroll just in case, but unused in main view
        scroll: (
          <path d="M8 2h2a5 5 0 0 1 5 5v11a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V7a5 5 0 0 1 5-5h2v16a6 6 0 0 1-6 6H14a6 6 0 0 1-6-6V2zm11 15h2" />
        ),
        "arrow-right": <path d="M5 12h14m-7-7 7 7-7 7" />,
        "arrow-left": <path d="M19 12H5m7 7-7-7 7-7" />,
        sun: (
          <>
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32 1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
          </>
        ),
        moon: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />,
        "book-open": (
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
        ),
        play: <polygon points="5 3 19 12 5 21 5 3" />,
        "help-circle": (
          <>
            <circle cx="12" cy="12" r="10" />
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3m.08 4h.01" />
          </>
        ),
        x: <path d="M18 6 6 18M6 6l12 12" />,
        check: <polyline points="20 6 9 17 4 12" />,
        trophy: (
          <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6m12 5h1.5a2.5 2.5 0 0 0 0-5H18m-6 11v3m0-16V3m0 0A6 6 0 0 0 6 9v2a6 6 0 0 0 6 6h0a6 6 0 0 0 6-6V9a6 6 0 0 0-6-6Z" />
        ),
        target: (
          <>
            <circle cx="12" cy="12" r="10" />
            <circle cx="12" cy="12" r="6" />
            <circle cx="12" cy="12" r="2" />
          </>
        ),
        "rotate-ccw": (
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
        ),
      };

      const Icon = memo(({ name, size = 20, className }) => {
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width={size}
            height={size}
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2.5"
            strokeLinecap="round"
            strokeLinejoin="round"
            className={className}
          >
            {ICONS[name] || <circle cx="12" cy="12" r="10" />}
          </svg>
        );
      });

      // --- ERROR BOUNDARY ---
      class ErrorBoundary extends React.Component {
        constructor(props) {
          super(props);
          this.state = { hasError: false, error: null };
        }
        static getDerivedStateFromError(error) {
          return { hasError: true, error };
        }
        componentDidCatch(error, errorInfo) {
          console.error("ErrorBoundary caught error", error, errorInfo);
        }
        render() {
          if (this.state.hasError) {
            return (
              <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center dark:bg-gray-900 dark:text-white">
                <div className="bg-red-100 dark:bg-red-900/30 p-6 rounded-2xl mb-4">
                  <h1 className="text-xl font-bold mb-2 text-red-600 dark:text-red-400">
                    Application Error
                  </h1>
                  <p className="text-sm opacity-75">
                    {this.state.error?.toString()}
                  </p>
                </div>
                <button
                  onClick={() => window.location.reload()}
                  className="px-6 py-2 bg-sky-600 text-white rounded-lg font-bold hover:bg-sky-700 transition-colors"
                >
                  Reload Application
                </button>
              </div>
            );
          }
          return this.props.children;
        }
      }

      // --- PARSER ENGINE ---
      function parseData() {
        const rawText =
          typeof window.QUIZ_DATA_TEXT !== "undefined" && window.QUIZ_DATA_TEXT
            ? window.QUIZ_DATA_TEXT
            : MOCK_DATA;

        // FIXED: Initialize geography array immediately.
        const data = { geography: [] };

        // FIXED: Default sub to 'geography' to catch chapters before any subject tag
        let sub = "geography";

        let chap = null,
          q = null,
          mode = null;

        const lines = rawText.split("\n");

        for (let line of lines) {
          line = line.trim();
          if (!line || line.startsWith("//")) continue;

          if (line.startsWith("[SUBJECT:")) {
            // FIXED: Ignore actual text, force bucket
            sub = "geography";
            chap = null;
            continue;
          }

          if (line.startsWith("[CHAPTER:")) {
            const match = line.match(/\[CHAPTER:(.*)\]/i);
            if (match) {
              if (!data[sub]) data[sub] = [];
              chap = {
                id: Math.random().toString(36).substr(2, 9),
                title: match[1].trim(),
                questions: [],
              };
              data[sub].push(chap);
            }
            continue;
          }

          if (line.match(/^Q[:\.]/i)) {
            if (chap) {
              q = {
                question: line.replace(/^Q[:\.]\s*/i, ""),
                options: [],
                correctAnswer: 0,
              };
              chap.questions.push(q);
              mode = "Q";
            }
            continue;
          }

          const optMatch = line.match(/^[\(\[]?([A-D])[\)\]\.]\s*(.*)/i);
          if (optMatch) {
            if (q) {
              q.options.push(optMatch[2]);
              mode = "OPT";
            }
            continue;
          }

          const ansMatch = line.match(/^(ANS|ANSWER)[:\.]\s*([A-D])/i);
          if (ansMatch) {
            if (q)
              q.correctAnswer = ansMatch[2].toUpperCase().charCodeAt(0) - 65;
            mode = null;
            continue;
          }

          if (mode === "Q" && q && !line.startsWith("[")) {
            q.question += "\n" + line;
          }
        }

        // Ensure geography array exists even if empty
        if (!data.geography) data.geography = [];
        return data;
      }

      // --- COMPONENTS ---
      const ThemeBtn = memo(({ dark, setDark }) => (
        <button
          onClick={() => setDark(!dark)}
          className="fixed top-4 right-4 z-50 p-2.5 rounded-full bg-white/90 dark:bg-gray-800/90 backdrop-blur-md border border-gray-200 dark:border-gray-700 shadow-lg text-gray-800 dark:text-gray-200 transition-all hover:scale-110 active:scale-95 group"
          title="Toggle Theme"
        >
          <Icon
            name={dark ? "sun" : "moon"}
            size={20}
            className="group-hover:rotate-12 transition-transform duration-300"
          />
        </button>
      ));

      function QuizApp() {
        const [data, setData] = useState(null);
        const [view, setView] = useState("loading");
        const [dark, setDark] = useState(
          () => localStorage.getItem("darkMode") === "true"
        );
        const [sub, setSub] = useState(null);
        const [chap, setChap] = useState(null);
        const [qIdx, setQIdx] = useState(0);
        const [ans, setAns] = useState({});
        const [qKey, setQKey] = useState(0);

        useEffect(() => {
          try {
            const parsed = parseData();
            setData(parsed);
            setView("welcome");
          } catch (e) {
            console.error(e);
            alert("Error loading data: " + e.message);
          }
        }, []);

        useEffect(() => {
          document.documentElement.classList.toggle("dark", dark);
          localStorage.setItem("darkMode", dark);
        }, [dark]);

        const start = useCallback((c) => {
          setChap(c);
          setQIdx(0);
          setAns({});
          setView("quiz");
          setQKey(Date.now());
          window.scrollTo({ top: 0, behavior: "smooth" });
        }, []);

        const handleOpt = useCallback(
          (i) => {
            if (ans[qIdx] === undefined) {
              setAns((p) => ({ ...p, [qIdx]: i }));
            }
          },
          [ans, qIdx]
        );

        const nav = useCallback(
          (d) => {
            const n = qIdx + d;
            if (n >= 0 && n < chap.questions.length) {
              setQIdx(n);
              setQKey(Date.now());
              window.scrollTo({ top: 0, behavior: "smooth" });
            } else if (d > 0) {
              setView("result");
              window.scrollTo({ top: 0, behavior: "smooth" });
            }
          },
          [qIdx, chap]
        );

        // --- VIEWS ---

        if (view === "loading")
          return (
            <div className="h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
              <div className="animate-pulse text-lg dark:text-white font-medium flex items-center">
                Loading Experience...
              </div>
            </div>
          );

        if (view === "welcome")
          return (
            <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50 dark:bg-gray-900 relative overflow-hidden transition-colors duration-500">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="text-center animate-fade-in z-10 max-w-lg w-full">
                {/* Updated Gradient to Blue/Sky */}
                <div className="mb-8 inline-flex p-8 bg-gradient-to-tr from-sky-600 to-blue-800 rounded-[2rem] shadow-2xl rotate-3 hover:rotate-0 transition-all duration-700 ring-4 ring-white dark:ring-gray-800">
                  <Icon
                    name="globe"
                    size={64}
                    className="text-white drop-shadow-md"
                  />
                </div>
                <h1 className="text-5xl font-extrabold mb-6 text-gray-900 dark:text-white tracking-tight leading-tight">
                  Master{" "}
                  <span className="text-transparent bg-clip-text bg-gradient-to-r from-sky-600 to-blue-500">
                    Geography
                  </span>
                </h1>
                <p className="text-lg text-gray-600 dark:text-gray-400 mb-10 font-light max-w-md mx-auto leading-relaxed">
                  Explore the world with our premium interactive quizzes.
                </p>
                <button
                  onClick={() => setView("subjects")}
                  className="group px-8 py-4 text-lg font-bold text-white bg-sky-600 hover:bg-sky-700 rounded-xl shadow-lg shadow-sky-500/20 hover:scale-105 active:scale-95 flex items-center mx-auto transition-all"
                >
                  Start Learning{" "}
                  <Icon
                    name="arrow-right"
                    className="ml-2 group-hover:translate-x-1 transition-transform"
                    size={20}
                  />
                </button>
              </div>
              <div className="absolute -bottom-40 -left-40 w-[40vw] h-[40vw] bg-sky-500/5 dark:bg-sky-500/5 rounded-full blur-[100px] pointer-events-none"></div>
              <div className="absolute -top-40 -right-40 w-[40vw] h-[40vw] bg-blue-500/5 dark:bg-blue-500/5 rounded-full blur-[100px] pointer-events-none"></div>
            </div>
          );

        if (view === "subjects")
          return (
            <div className="min-h-screen p-4 md:p-6 bg-gray-50 dark:bg-gray-900 transition-colors duration-500">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="max-w-4xl mx-auto mt-6 animate-slide-up">
                <button
                  onClick={() => setView("welcome")}
                  className="flex items-center text-gray-500 dark:text-gray-400 hover:text-sky-600 mb-6 font-semibold text-base transition-colors"
                >
                  <Icon name="arrow-left" size={20} className="mr-2" /> Back
                </button>
                <h2 className="text-3xl font-bold dark:text-white mb-6 tracking-tight">
                  Select Subject
                </h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-5">
                  {[
                    {
                      id: "geography", // Changed ID
                      name: "Geography", // Changed Name
                      icon: "globe", // Changed Icon
                      c: "from-sky-600 to-blue-800", // Changed Colors
                    },
                  ].map((s) => (
                    <button
                      key={s.id}
                      onClick={() => {
                        setSub(s);
                        setView("chapters");
                      }}
                      className="relative w-full p-6 bg-white dark:bg-gray-800 rounded-3xl shadow-lg hover:shadow-xl transition-all text-left border border-gray-100 dark:border-gray-700 group hover:-translate-y-1 overflow-hidden"
                    >
                      <div
                        className={`absolute inset-0 opacity-0 group-hover:opacity-5 bg-gradient-to-br ${s.c} transition-opacity duration-500`}
                      ></div>
                      <div
                        className={`inline-flex p-4 rounded-2xl bg-gradient-to-br ${s.c} text-white mb-4 shadow-md group-hover:scale-105 transition-transform duration-300`}
                      >
                        <Icon name={s.icon} size={32} />
                      </div>
                      <h3 className="text-2xl font-bold mb-2 dark:text-white group-hover:text-sky-600 dark:group-hover:text-sky-400 transition-colors">
                        {s.name}
                      </h3>
                      <div className="flex items-center justify-between mt-4">
                        <p className="text-gray-500 dark:text-gray-400 font-medium text-sm flex items-center">
                          <Icon
                            name="book-open"
                            size={16}
                            className="mr-2 opacity-70"
                          />{" "}
                          {data[s.id]?.length || 0} Chapters
                        </p>
                        <div className="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center group-hover:bg-sky-600 group-hover:text-white transition-colors">
                          <Icon name="arrow-right" size={16} />
                        </div>
                      </div>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          );

        if (view === "chapters")
          return (
            <div className="min-h-screen p-4 md:p-6 bg-gray-50 dark:bg-gray-900 transition-colors duration-500">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="max-w-4xl mx-auto mt-6 animate-slide-up">
                <button
                  onClick={() => setView("subjects")}
                  className="flex items-center text-gray-500 dark:text-gray-400 hover:text-sky-600 mb-6 font-semibold text-base transition-colors"
                >
                  <Icon name="arrow-left" size={20} className="mr-2" /> Back
                </button>

                {/* Compact Header Card */}
                <div className="flex flex-row items-center bg-white dark:bg-gray-800 p-5 rounded-[1.5rem] shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
                  <div
                    className={`p-3 rounded-xl mr-5 bg-gradient-to-br ${sub.c} text-white shadow-lg`}
                  >
                    <Icon name={sub.icon} size={28} />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold dark:text-white mb-1">
                      {sub.name}
                    </h2>
                    <p className="text-gray-500 dark:text-gray-400 text-sm">
                      Select a chapter.
                    </p>
                  </div>
                </div>

                <div className="grid gap-3">
                  {(data[sub.id] || []).length === 0 ? (
                    <div className="p-8 text-center text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-2xl border border-dashed border-gray-300 dark:border-gray-700">
                      No chapters available.
                    </div>
                  ) : (
                    (data[sub.id] || []).map((c, i) => (
                      <button
                        key={c.id}
                        onClick={() => start(c)}
                        className="w-full flex items-center justify-between p-3 md:p-4 bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100 dark:border-gray-700 group hover:border-sky-500 dark:hover:border-sky-500/50 hover:-translate-y-0.5"
                      >
                        <div className="flex items-center">
                          <span className="w-10 h-10 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 font-bold text-base flex items-center justify-center mr-4 group-hover:bg-sky-600 group-hover:text-white transition-all shadow-inner">
                            {i + 1}
                          </span>
                          <div className="text-left">
                            <h3 className="text-base md:text-lg font-bold text-gray-800 dark:text-gray-100 group-hover:text-sky-600 dark:group-hover:text-sky-400 transition-colors line-clamp-1">
                              {c.title}
                            </h3>
                            <p className="text-xs text-gray-500 dark:text-gray-400 mt-0.5 font-medium flex items-center">
                              <Icon
                                name="help-circle"
                                size={12}
                                className="mr-1"
                              />
                              {c.questions.length} Qs
                            </p>
                          </div>
                        </div>
                        <div className="w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700/50 flex items-center justify-center group-hover:bg-sky-600 group-hover:text-white transition-all">
                          <Icon name="play" size={14} className="ml-0.5" />
                        </div>
                      </button>
                    ))
                  )}
                </div>
              </div>
            </div>
          );

        if (view === "quiz") {
          const curQ = chap.questions[qIdx];
          if (!curQ)
            return (
              <div className="min-h-screen flex items-center justify-center dark:text-white">
                Error: Question Data Missing.{" "}
                <button
                  onClick={() => setView("chapters")}
                  className="ml-4 text-sky-500 underline"
                >
                  Go Back
                </button>
              </div>
            );

          const isAns = ans[qIdx] !== undefined;

          // --- QUIZ LAYOUT ---
          return (
            <div className="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-500 flex flex-col justify-center pb-6 md:pb-0">
              <ThemeBtn dark={dark} setDark={setDark} />

              <div className="w-full max-w-4xl mx-auto px-4 md:px-6 py-4 animate-slide-up">
                {/* Header - Compact */}
                <div className="flex justify-between items-center mb-4">
                  <button
                    onClick={() => setView("chapters")}
                    className="flex items-center text-gray-500 dark:text-gray-400 hover:text-sky-600 px-3 py-1.5 rounded-lg hover:bg-white dark:hover:bg-gray-800 transition-all font-semibold text-sm"
                  >
                    <Icon name="x" size={18} className="mr-1.5" /> Quit
                  </button>
                  <div className="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider bg-white dark:bg-gray-800 px-3 py-1.5 rounded-full shadow-sm border border-gray-100 dark:border-gray-700 truncate max-w-[200px]">
                    {chap.title}
                  </div>
                </div>

                {/* Progress Bar - Compact - Updated color to Sky */}
                <div className="h-2 bg-gray-200 dark:bg-gray-800 rounded-full mb-6 overflow-hidden shadow-inner">
                  <div
                    className="h-full bg-gradient-to-r from-sky-500 to-sky-600 transition-all duration-500 ease-out shadow-[0_0_10px_rgba(2,132,199,0.5)]"
                    style={{
                      width: `${((qIdx + 1) / chap.questions.length) * 100}%`,
                    }}
                  />
                </div>

                {/* Question Card - Compact & Screen Fitting */}
                <div
                  key={qKey}
                  className="bg-white dark:bg-gray-800 rounded-3xl shadow-lg p-5 md:p-8 border border-gray-100 dark:border-gray-700 mb-6 relative overflow-hidden"
                >
                  <div className="absolute top-0 right-0 w-24 h-24 bg-gray-50 dark:bg-gray-700 rounded-bl-[2.5rem] -mr-6 -mt-6 opacity-50 pointer-events-none"></div>

                  <div className="mb-5 relative z-10">
                    <span className="inline-block px-2.5 py-0.5 text-[10px] md:text-xs font-bold text-sky-600 dark:text-sky-300 bg-sky-50 dark:bg-sky-900/30 rounded-full mb-3 border border-sky-100 dark:border-sky-900/50">
                      Question {qIdx + 1}{" "}
                      <span className="opacity-50 mx-1">/</span>{" "}
                      {chap.questions.length}
                    </span>
                    <h2 className="text-lg md:text-xl font-bold leading-snug text-gray-900 dark:text-white whitespace-pre-line tracking-wide">
                      {curQ.question}
                    </h2>
                  </div>

                  <div className="space-y-2.5 relative z-10">
                    {curQ.options.map((o, i) => {
                      const sel = ans[qIdx] === i;
                      const cor = curQ.correctAnswer === i;

                      let btnClass =
                        "w-full text-left p-3 md:p-3.5 rounded-xl border-2 transition-all duration-200 flex items-center group text-sm md:text-base ";

                      if (isAns) {
                        if (sel && cor) {
                          btnClass +=
                            "bg-green-50 border-green-500 text-green-900 dark:bg-green-900/30 dark:border-green-500 dark:text-green-100 shadow-sm transform scale-[1.01]";
                        } else if (sel && !cor) {
                          btnClass +=
                            "bg-red-50 border-red-500 text-red-900 dark:bg-red-900/30 dark:border-red-500 dark:text-red-100 shadow-sm transform scale-[1.01]";
                        } else if (!sel && cor) {
                          btnClass +=
                            "bg-green-50/50 border-green-300 text-green-800 dark:bg-green-900/20 dark:border-green-500/50 dark:text-green-200 border-dashed opacity-80";
                        } else {
                          btnClass +=
                            "bg-gray-50 border-transparent text-gray-400 dark:bg-gray-800/50 dark:border-transparent dark:text-gray-600 opacity-50 grayscale";
                        }
                      } else {
                        btnClass +=
                          "bg-gray-50 border-transparent text-gray-800 hover:bg-white hover:border-sky-300 hover:shadow-md hover:scale-[1.005] active:scale-[0.99] " +
                          "dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:hover:bg-gray-600 dark:hover:border-sky-500/50";
                      }

                      return (
                        <button
                          key={i}
                          disabled={isAns}
                          onClick={() => handleOpt(i)}
                          className={btnClass}
                        >
                          <span
                            className={`w-8 h-8 md:w-9 md:h-9 rounded-lg flex items-center justify-center font-bold text-sm md:text-base mr-3 flex-shrink-0 transition-colors ${
                              isAns
                                ? "bg-transparent"
                                : "bg-white dark:bg-gray-600 shadow-sm group-hover:bg-sky-600 group-hover:text-white dark:group-hover:bg-sky-500"
                            }`}
                          >
                            {String.fromCharCode(65 + i)}
                          </span>
                          <span className="flex-1 font-medium leading-snug">
                            {o}
                          </span>
                          {isAns && sel && cor && (
                            <div className="bg-green-500 rounded-full p-0.5 animate-scale-in ml-2">
                              <Icon
                                name="check"
                                className="text-white"
                                size={14}
                              />
                            </div>
                          )}
                          {isAns && sel && !cor && (
                            <div className="bg-red-500 rounded-full p-0.5 animate-scale-in ml-2">
                              <Icon name="x" className="text-white" size={14} />
                            </div>
                          )}
                        </button>
                      );
                    })}
                  </div>
                </div>

                {/* Navigation Buttons - Compact */}
                <div className="flex justify-between items-center gap-3 md:gap-4">
                  <button
                    onClick={() => nav(-1)}
                    disabled={qIdx === 0}
                    className={`px-5 py-3 rounded-xl font-bold text-sm md:text-base flex items-center transition-all ${
                      qIdx === 0
                        ? "opacity-0 pointer-events-none"
                        : "bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 shadow-sm hover:-translate-y-0.5"
                    }`}
                  >
                    <Icon name="arrow-left" size={16} className="mr-2" /> Prev
                  </button>
                  <button
                    onClick={() => nav(1)}
                    className="flex-1 max-w-xs px-5 py-3 rounded-xl font-bold text-sm md:text-base text-white bg-gradient-to-r from-sky-600 to-sky-700 hover:from-sky-500 hover:to-sky-600 shadow-lg shadow-sky-500/30 hover:shadow-sky-500/50 hover:scale-[1.02] active:scale-95 flex items-center justify-center transition-all group"
                  >
                    {qIdx === chap.questions.length - 1
                      ? "Finish Quiz"
                      : "Next Question"}{" "}
                    <Icon
                      name="arrow-right"
                      size={16}
                      className="ml-2 group-hover:translate-x-1 transition-transform"
                    />
                  </button>
                </div>
              </div>
            </div>
          );
        }

        if (view === "result") {
          let score = 0;
          chap.questions.forEach((q, i) => {
            if (ans[i] === q.correctAnswer) score++;
          });
          const pct = Math.round((score / chap.questions.length) * 100) || 0;
          const isPass = pct >= 60;

          return (
            <div className="min-h-screen flex items-center justify-center p-4 bg-gray-50 dark:bg-gray-900 transition-colors duration-500">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="bg-white dark:bg-gray-800 p-8 md:p-12 rounded-[2.5rem] shadow-2xl text-center max-w-lg w-full animate-scale-in border border-white dark:border-gray-700 relative overflow-hidden">
                <div
                  className={`absolute top-0 left-0 w-full h-2 bg-gradient-to-r ${
                    isPass
                      ? "from-green-400 to-green-600"
                      : "from-red-400 to-red-600"
                  }`}
                ></div>
                <div className="relative inline-block mb-8">
                  <div
                    className={`absolute inset-0 blur-3xl opacity-40 ${
                      isPass ? "bg-green-500" : "bg-red-500"
                    }`}
                  ></div>
                  <div
                    className={`relative z-10 p-6 rounded-full ${
                      isPass
                        ? "bg-green-50 dark:bg-green-900/20"
                        : "bg-red-50 dark:bg-red-900/20"
                    }`}
                  >
                    <Icon
                      name={isPass ? "trophy" : "target"}
                      size={60}
                      className={`${
                        isPass ? "text-green-500" : "text-red-500"
                      }`}
                    />
                  </div>
                </div>
                <h2 className="text-4xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400">
                  {pct >= 90
                    ? "Legendary!"
                    : pct >= 60
                    ? "Great Job!"
                    : "Keep Going!"}
                </h2>
                <div className="mb-10 p-6 rounded-2xl bg-gray-50 dark:bg-gray-900/50 border border-gray-100 dark:border-gray-700">
                  <div className="flex justify-center items-baseline mb-2">
                    <span className="text-6xl font-black dark:text-white tracking-tighter">
                      {pct}
                    </span>
                    <span className="text-2xl font-bold text-gray-400 ml-1">
                      %
                    </span>
                  </div>
                  <div className="text-lg text-gray-600 dark:text-gray-400 font-medium">
                    You answered{" "}
                    <b
                      className={
                        isPass
                          ? "text-green-600 dark:text-green-400"
                          : "text-red-600 dark:text-red-400"
                      }
                    >
                      {score}
                    </b>{" "}
                    correctly out of {chap.questions.length}
                  </div>
                </div>
                <div className="flex gap-4 flex-col sm:flex-row">
                  <button
                    onClick={() => start(chap)}
                    className="flex-1 py-4 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-white font-bold text-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center justify-center"
                  >
                    <Icon name="rotate-ccw" className="mr-2" size={20} /> Retry
                  </button>
                  <button
                    onClick={() => setView("subjects")}
                    className="flex-1 py-4 rounded-xl bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-bold text-lg hover:scale-105 transition-all shadow-md"
                  >
                    Finish
                  </button>
                </div>
              </div>
            </div>
          );
        }
        return null;
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(
        <ErrorBoundary>
          <QuizApp />
        </ErrorBoundary>
      );
    </script>
  </body>
</html>
